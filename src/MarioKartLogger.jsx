import React, { useState } from "react";

const tracks = [
  "Acorn Heights","Airship Fortress","Boo Cinema","Bowser's Castle","Cheep Cheep Falls",
    "Choco Mountain","Crown City","Dandelion Depths","Desert Hills","Dino Dino Jungle",
      "DK Pass","DK Spaceport","Dry Bones Burnout","Faraway Oasis","Great ? Block Ruins",
        "Koopa Troopa Beach","Mario Bros. Circuit","Mario Circuit","Moo Moo Meadows","Peach Beach",
          "Peach Stadium","Rainbow Road","Salty Salty Speedway","Shy Guy Bazaar","Sky-High Sundae",
            "Starview Peak","Toad's Factory","Wario Stadium","Wario's Galleon","Whistlestop Summit"
            ];

            // Map clean names → filenames in public/tracks
            const trackIcons = {
              "Acorn Heights": "360px-MKWd_Acorn_Heights_Icon.png",
                "Airship Fortress": "360px-MKWd_Airship_Fortress_Icon.png",
                  "Boo Cinema": "360px-MKWd_Boo_Cinema_Icon.png",
                    "Bowser's Castle": "360px-MKWd_Bowsers_Castle_Icon.png",
                      "Cheep Cheep Falls": "360px-MKWd_Cheep_Cheep_Falls_Icon.png",
                        "Choco Mountain": "360px-MKWd_Choco_Mountain_Icon.png",
                          "Crown City": "360px-MKWd_Crown_City_Icon.png",
                            "Dandelion Depths": "360px-MKWd_Dandelion_Depths_Icon.png",
                              "Desert Hills": "360px-MKWd_Desert_Hills_Icon.png",
                                "Dino Dino Jungle": "360px-MKWd_Dino_Dino_Jungle_Icon.png",
                                  "DK Pass": "360px-MKWd_DK_Pass_Icon.png",
                                    "DK Spaceport": "360px-MKWd_DK_Spaceport_Icon.png",
                                      "Dry Bones Burnout": "360px-MKWd_Dry_Bones_Burnout_Icon.png",
                                        "Faraway Oasis": "360px-MKWd_Faraway_Oasis_Icon.png",
                                          "Great ? Block Ruins": "360px-MKWd_Great_Block_Ruins_Icon.png",
                                            "Koopa Troopa Beach": "360px-MKWd_Koopa_Troopa_Beach_Icon.png",
                                              "Mario Bros. Circuit": "360px-MKWd_Mario_Bros_Circuit_Icon.png",
                                                "Mario Circuit": "360px-MKWd_Mario_Circuit_Icon.png",
                                                  "Moo Moo Meadows": "360px-MKWd_Moo_Moo_Meadows_Icon.png",
                                                    "Peach Beach": "360px-MKWd_Peach_Beach_Icon.png",
                                                      "Peach Stadium": "360px-MKWd_Peach_Stadium_Icon.png",
                                                        "Rainbow Road": "360px-MKWorld_Rainbow_Road_icon.png",
                                                          "Salty Salty Speedway": "360px-MKWd_Salty_Salty_Speedway_Icon.png",
                                                            "Shy Guy Bazaar": "360px-MKWd_Shy_Guy_Bazaar_Icon.png",
                                                              "Sky-High Sundae": "360px-MKWd_Sky_High_Sundae_Icon.png",
                                                                "Starview Peak": "360px-MKWd_Starview_Peak_Icon.png",
                                                                  "Toad's Factory": "360px-MKWd_Toads_Factory_Icon.png",
                                                                    "Wario Stadium": "360px-MKWd_Wario_Stadium_Icon.png",
                                                                      "Wario's Galleon": "360px-MKWd_Warios_Galleon_Icon.png",
                                                                        "Whistlestop Summit": "360px-MKWd_Whistlestop_Summit_Icon.png"
                                                                        };

                                                                        export default function MarioKartLogger() {
                                                                          const [track, setTrack] = useState("");
                                                                            const [placement, setPlacement] = useState("");
                                                                              const [roomSize, setRoomSize] = useState("");
                                                                                const [entries, setEntries] = useState([]);
                                                                                  const [error, setError] = useState("");
                                                                                    const [view, setView] = useState("form"); // form, history, stats

                                                                                      const handleSubmit = (e) => {
                                                                                          e.preventDefault();
                                                                                              const placementNum = parseInt(placement, 10);
                                                                                                  const roomSizeNum = parseInt(roomSize, 10);

                                                                                                      if (!track || isNaN(placementNum) || isNaN(roomSizeNum) ||
                                                                                                              placementNum < 1 || placementNum > 24 ||
                                                                                                                      roomSizeNum < 1 || roomSizeNum > 24) {
                                                                                                                            setError("Please enter valid values (1–24 for placement and room size).");
                                                                                                                                  return;
                                                                                                                                      }

                                                                                                                                          const newEntry = {
                                                                                                                                                id: Date.now(),
                                                                                                                                                      track,
                                                                                                                                                            placement: placementNum,
                                                                                                                                                                  roomSize: roomSizeNum,
                                                                                                                                                                        date: new Date().toLocaleString(),
                                                                                                                                                                            };

                                                                                                                                                                                setEntries([...entries, newEntry]);
                                                                                                                                                                                    setTrack("");
                                                                                                                                                                                        setPlacement("");
                                                                                                                                                                                            setRoomSize("");
                                                                                                                                                                                                setError("");
                                                                                                                                                                                                  };

                                                                                                                                                                                                    const deleteEntry = (id) => {
                                                                                                                                                                                                        setEntries(entries.filter((e) => e.id !== id));
                                                                                                                                                                                                          };

                                                                                                                                                                                                            // Helper: compute stats per track
                                                                                                                                                                                                              function getTrackStats(trackName) {
                                                                                                                                                                                                                  const trackEntries = entries.filter((e) => e.track === trackName);
                                                                                                                                                                                                                      if (trackEntries.length === 0) return null;

                                                                                                                                                                                                                          const placements = trackEntries.map((e) => e.placement);
                                                                                                                                                                                                                              const avg = (placements.reduce((a, b) => a + b, 0) / placements.length).toFixed(2);
                                                                                                                                                                                                                                  const best = Math.min(...placements);
                                                                                                                                                                                                                                      const worst = Math.max(...placements);
                                                                                                                                                                                                                                          const wins = placements.filter((p) => p === 1).length;
                                                                                                                                                                                                                                              const winRate = ((wins / placements.length) * 100).toFixed(1);

                                                                                                                                                                                                                                                  return { races: trackEntries.length, average: avg, best, worst, winRate };
                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                      return (
                                                                                                                                                                                                                                                          <div style={{ padding: "20px", fontFamily: "sans-serif" }}>
                                                                                                                                                                                                                                                                {/* Navigation */}
                                                                                                                                                                                                                                                                      <nav style={{ marginBottom: "20px" }}>
                                                                                                                                                                                                                                                                              <button onClick={() => setView("form")}>Add Result</button>
                                                                                                                                                                                                                                                                                      <button onClick={() => setView("history")} style={{ marginLeft: "10px" }}>View History</button>
                                                                                                                                                                                                                                                                                              <button onClick={() => setView("stats")} style={{ marginLeft: "10px" }}>Track Stats</button>
                                                                                                                                                                                                                                                                                                    </nav>

                                                                                                                                                                                                                                                                                                          {/* Add Result Form */}
                                                                                                                                                                                                                                                                                                                {view === "form" && (
                                                                                                                                                                                                                                                                                                                        <form onSubmit={handleSubmit}>
                                                                                                                                                                                                                                                                                                                                  <div>
                                                                                                                                                                                                                                                                                                                                              <label>
                                                                                                                                                                                                                                                                                                                                                            Track:
                                                                                                                                                                                                                                                                                                                                                                          <select value={track} onChange={(e) => setTrack(e.target.value)}>
                                                                                                                                                                                                                                                                                                                                                                                          <option value="">-- Select a track --</option>
                                                                                                                                                                                                                                                                                                                                                                                                          {tracks.map((t) => (
                                                                                                                                                                                                                                                                                                                                                                                                                            <option key={t} value={t}>{t}</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                            ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                          </select>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Placement:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <input type="number" value={placement} onChange={(e) => setPlacement(e.target.value)} />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Room Size:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <input type="number" value={roomSize} onChange={(e) => setRoomSize(e.target.value)} />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          {error && <p style={{ color: "red" }}>{error}</p>}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <button type="submit">Add Result</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </form>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {/* Race History */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {view === "history" && (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <h2>Race History</h2>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          {entries.length === 0 && <p>No entries yet.</p>}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {entries.map((e) => (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <li key={e.id}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <img
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                src={`/tracks/${trackIcons[e.track]}`}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  alt={e.track}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    style={{ width: 24, height: 24, verticalAlign: "middle", marginRight: 6 }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {e.track} — {e.placement}/{e.roomSize} ({e.date})
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <button onClick={() => deleteEntry(e.id)} style={{ marginLeft: "10px" }}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Delete
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {/* Track Stats */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {view === "stats" && (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <h2>Per-Track Stats</h2>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <table border="1" cellPadding="6" style={{ marginTop: "10px", borderCollapse: "collapse" }}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <thead>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Track</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Total Races</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Average Placement</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Best</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Worst</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Win Rate</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </thead>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <tbody>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {tracks.map((t) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const stats = getTrackStats(t);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <tr key={t}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td style={{ whiteSpace: "nowrap" }}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          {t}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        src={`/tracks/${trackIcons[t]}`}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alt={t}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        style={{ width: 48, height: 48, verticalAlign: "middle", marginLeft: 10 }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {stats ? (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td>{stats.races}</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <td>{stats.average}</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td>{stats.best}</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <td>{stats.worst}</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td>{stats.winRate}%</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ) : (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td colSpan="5" style={{ textAlign: "center" }}>No data</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        })}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </tbody>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  